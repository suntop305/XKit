{"id":"reblog_yourself","script":"//* TITLE Reblog Yourself **//\n//* VERSION 1.3.1 **//\n//* DESCRIPTION Allows you to reblog posts back to your blog **//\n//* DEVELOPER STUDIOXENIX **//\n//* FRAME false **//\n//* BETA false **//\n//* SLOW true **//\n\nXKit.extensions.reblog_yourself = {\n\n\trunning: false,\n\tslow: true,\n\tpreferences: {\n\t\t\"dashboard\": {\n\t\t\ttext: \"Enable reblogging yourself from the dashboard\",\n\t\t\tdefault: true,\n\t\t\tvalue: true\n\t\t},\n\t\t\"postpages\": {\n\t\t\ttext: \"Enable reblogging yourself from post pages\",\n\t\t\tdefault: true,\n\t\t\tvalue: true\n\t\t}\n\t},\n\n\trun: function() {\n\t\tthis.running = true;\n\n\t\tif (document.location.href.indexOf(\"://www.tumblr.com/reblog/\") !== -1) {\n\t\t\tXKit.extensions.reblog_yourself.fix_page();\n\t\t}\n\n\t\tif ($(\"body\").hasClass(\"is_private_channel\")) {return; }\n\n\t\tif ($(\".posts .post\").length > 0) {\n\t\t\t$(document).on(\"click\", \".post_control.reblog\", function() {\n\t\t\t\tif ($(this).parentsUntil(\".post\").parent().hasClass(\"is_mine\") === true) {\n\t\t\t\t\tXKit.extensions.reblog_yourself.fix_page();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (XKit.extensions.reblog_yourself.preferences.dashboard.value === true) {\n\t\t\tXKit.post_listener.add(\"reblog_yourself\", XKit.extensions.reblog_yourself.fix_dashboard);\n\t\t\tXKit.extensions.reblog_yourself.fix_dashboard();\n\t\t}\n\n\t},\n\n\tframe_run: function() {\n\n\t\tif (XKit.extensions.reblog_yourself.preferences.postpages.value === false)\n\t\t\treturn;\n\t\t// This gets run on frame.\n\t\t// Port of ugly code from XKit 6 but at least it works.\n\n\t\t$(\".btn.icon.dashboard, .btn.icon.edit, .btn.icon.follow\").html(\"\");\n\t\t$(\".btn.icon.dashboard, .btn.icon.edit, .btn.icon.follow\").addClass(\"no_label\");\n\n\t\tvar check_if_there = $(\"body\").html().search(\"/reblog/\");\n\t\tif (check_if_there !== -1) { return; }\n\n\t\tvar postid_start = document.location.href.search(\"&pid=\");\n\t\tvar postid_end =  document.location.href.indexOf(\"&\", postid_start + 2);\n\t\tvar post_id = document.location.href.substring(postid_start + 5, postid_end);\n\n\t\tif (postid_start === -1) { return; }\n\n\t\tvar xd_start = document.location.href.search(\"&rk=\");\n\t\tvar xd_end =  document.location.href.indexOf(\"&\", xd_start + 2);\n\t\tvar xd = document.location.href.substring(xd_start + 4, xd_end);\n\n\t\tvar rd_start = document.location.href.search(\"src=\") + 4;\n\t\tvar rd_end =  document.location.href.indexOf(\"&\", rd_start + 2);\n\t\tvar rd = document.location.href.substring(rd_start, rd_end);\n\n\t\tvar xu_html = '<a class=\"btn icon reblog no_label\" id=\"xreblogyourselfiframebutton\" style=\"display: none;\" title=\"Reblog\" href=\"/reblog/' + post_id + '/' + xd + '?redirect_to=' + rd + '\" target=\"_top\"></a>';\n\n\n\t\t$.ajax({\n\t\t\turl: '/reblog/' + post_id + '/' + xd + '/',\n\t\t\tsuccess: function(data, xhr) {\n\t\t\t\t$(\".controls\").prepend(xu_html);\n\t\t\t\t$(\"#xreblogyourselfiframebutton\").fadeIn('slow');\n\t\t\t}\n\t\t});\n\n\t},\n\n\tfix_page_interval: \"\",\n\n\tfix_page: function() {\n\n\t\tif ($(\"#tumblelog_choices\").length === 0) {\n\t\t\tXKit.console.add(\"Can't run Reblog Yourself, delaying..\");\n\t\t\tsetTimeout(function() { XKit.extensions.reblog_yourself.fix_page(); }, 300);\n\t\t\treturn;\n\t\t}\n\n\t\tif ($(\"#popover_blogs\").length === 0) {\n\t\t\tXKit.console.add(\"Can't run Reblog Yourself, popover_blogs not found.\");\n\t\t\treturn;\n\t\t}\n\n\t\t// defaults\n\t\tvar m_blog_url = $(\"#popover_blogs\").find(\".popover_menu_item\").first().attr('id').replace(\"menuitem-\", \"\");\n\t\tvar m_blog_title = $(\"#popover_blogs\").find(\".popover_menu_item\").first().find(\".blog_title\").find(\"span\").html();\n\n\t\t// check which blog is missing from the list\n\t\tvar m_blogs = XKit.tools.get_blogs();\n\t\tvar check = [];\n\t\tvar do_add = false;\n\t\tvar m_blog_avatar = \"\";\n\t\tfor (var i = 0; i < m_blogs.length; i++) {\n\t\t\tif (m_blogs[i] !== \"\") {\n\t\t\t\tcheck = $('#tumblelog_choices').find('.popover_inner ul li div[data-option-value=' + m_blogs[i] + ']');\n\t\t\t\tif (check.length <= 0) {\n\t\t\t\t\tdo_add = true;\n\t\t\t\t\tm_blog_url = m_blogs[i];\n\t\t\t\t\tm_blog_title = $(\"#menuitem-\" + m_blog_url + \" .blog_title span\").html();\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tm_blog_avatar = $(\"#menuitem-\" + m_blog_url).find(\".blog_icon_image\").attr('src');\n\t\t\t\t\t\t// I'm pretty sure they just use PNG but just in case:\n\t\t\t\t\t\tm_blog_avatar = m_blog_avatar.replace(\"_40.png\", \"_64.png\");\n\t\t\t\t\t\tm_blog_avatar = m_blog_avatar.replace(\"_40.gif\", \"_64.gif\");\n\t\t\t\t\t\tm_blog_avatar = m_blog_avatar.replace(\"_40.jpg\", \"_64.jpg\");\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tXKit.console.add(\"reblog_yourself: \" + e.message);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// console.log(\"Found for \" + m_blogs[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!do_add) { return; }\n\n\t\tvar post_avatar = \"\";\n\t\ttry {\n\t\t\tpost_avatar = m_blog_avatar;\n\t\t} catch (e) {\n\t\t\tXKit.console.add(\"reblog_yourself: \" + e.message);\n\t\t}\n\n\t\tvar m_html = '<div class=\"option\" data-facebook-on=\"false\" data-twitter-on=\"false\" data-facebook=\"false\" data-twitter=\"false\" data-is-password-protected=\"false\" data-use-sub-avatar=\"\" data-use-channel-avatar=\"0\" data-blog-url=\"http://' + m_blog_url + '.tumblr.com/\" data-avatar-url=\"' + post_avatar + '\" data-user-avatar-url=\"' + post_avatar + '\" data-option-value=\"' + m_blog_url + '\" title=\"' + m_blog_title + '\">' + m_blog_url + '</div>';\n\n\t\t$(\"#tumblelog_choices\").find(\".popover_inner\").find(\"ul\").prepend(\"<li>\" + m_html + \"</li>\");\n\n\t},\n\n\tfix_dashboard: function() {\n\n\t\tif (XKit.interface.where().queue === true || XKit.interface.where().drafts === true) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ($(\".posts .post\").length === 0) { return; }\n\n\t\t$('.post.is_mine').not(\".xreblogyourself_done\").each(function(index) {\n\n\t\t\tif ($(this).hasClass(\"xreblogyourself_done\") === true) { return; }\n\n\t\t\tif ($(this).attr('id') === \"new_post\") { return; }\n\t\t\tif ($(this).hasClass(\"note\") === true) { return; }\n\t\t\tif ($(this).hasClass(\"is_note\") === true) { return; }\n\t\t\tif ($(this).hasClass(\"is_mine\") === false) { return; }\n\t\t\tif ($(this).css('visibility') === \"hidden\") { return; } // tumblr savior hack.\n\t\t\tif ($(this).css('display') === \"none\") { return; } // tumblr savior hack.\n\n\t\t\t$(this).addClass(\"xreblogyourself_done\");\n\n\t\t\tif ($(this).find('.post_controls').html().search('href=\"/reblog/') !== -1) {\n\t\t\t\t// this user can reblog themselves?!\n\t\t\t\tXKit.console.add(\"This user can reblog themselves, quitting.\");\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar post_id = $(this).attr('data-post-id');\n\t\t\tvar reblog_key = $(this).attr('data-reblog-key');\n\n\t\t\tif (post_id === \"\" || reblog_key === \"\") {\n\t\t\t\t// Can't do this for some reason.\n\t\t\t\tconsole.log(\"NO REBLOG / POST ID\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar m_html = \"<a class=\\\"post_control reblog added_by_xkit_reblog_yourself\\\" title=\\\"\\\" href=\\\"/reblog/\" + post_id + \"/\" + reblog_key + \"?redirect_to=%2Fdashboard\\\"><span class=\\\"offscreen\\\">Reblog</span></a>\";\n\t\t\t$(this).find('.post_control.post_control_menu.creator').before(m_html);\n\t\t});\n\n\t},\n\n\tdestroy: function() {\n\t\tXKit.post_listener.remove(\"reblog_yourself\");\n\t\t$(\".added_by_xkit_reblog_yourself\").remove();\n\t\t$(\".xreblogyourself_done\").removeClass(\"xreblogyourself_done\");\n\t\tthis.running = false;\n\t}\n\n};\n","file":"found","server":"up","errors":false,"icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpGNzdGMTE3NDA3MjA2ODExODA4MzkyMjM2MzU5MTQ4NCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpBRTdBNjZFRjM4NjcxMUUzQTFDQUFDOThEMTlDRUY3OSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpBRTdBNjZFRTM4NjcxMUUzQTFDQUFDOThEMTlDRUY3OSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZBN0YxMTc0MDcyMDY4MTE4MDgzOTIyMzYzNTkxNDg0IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkY3N0YxMTc0MDcyMDY4MTE4MDgzOTIyMzYzNTkxNDg0Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+vGn4bgAAAelJREFUeNpi/BrKQFPAxMAwasEAW8DCwEhrC5iGvA9obgEzbjmbTCD558h0FrdKRm5+PKb82dH+//tH0nzAJGvFFtMBZPx7dJHh+yfWmDa8DmX8vaEcRzJlYsBEjNzibGmzGLj4gAjI+Ht+zZ/DK/Caj90ckPGMjAyYiDWgiUlOG+oEOW3WqIl/Vpb+e3QVp/lATdjMASIWRiZWdNUGMSxuaaiREf7vyfVfTYZoKllLDzKrW4JdwYhpDjyIOFAQjxyLdfjfmycYvn2CKvn2CchlNvQASqErhkcgI4Y5MATMaCwoNv5493tmJIhRtJ1ZzRxI/31y/Xe/F8w9qIoZGREMNCmknMxKRImFooZRWJXZIhwkLCwDFVGzYPFtBKXXrS2Y+YAdR8QhuQ5Vzf8PjxiEpVksguAiIL+qmf/ZvwjTNBZcXoNbwCyjyZC/FsWCxzf+rG9jktFmklGHC/57cvPPhgZM04A+YMOZ9iCAk5dZxRRFRsX0/4vbv1dUs2fPB8qCRL5//j0/F6tRTCA7sSJGfIUUa0AZAyPzrxX1EC6Q8f/jM6zm4Ayiv7tn46+OWOxjfq+q/Xt4OQMnz7/r+3CZw/i93IS2pSkjMyuti2uWoW4BE819wDrkLaB1EDEy09gCFjaaWgAQYACGhXWcbhhxqAAAAABJRU5ErkJggg==","title":"Reblog Yourself","description":"Allows you to reblog posts back to your blog","developer":"STUDIOXENIX","version":"1.3.1","frame":"false","beta":"false","slow":"true"}