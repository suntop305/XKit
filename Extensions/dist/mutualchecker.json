{"id":"mutualchecker","script":"//* TITLE Mutual Checker **//\n//* VERSION 1.1.0 **//\n//* DESCRIPTION Adds an icon next to usernames to indicate if they follow you **//\n//* DETAILS Does what it says on the tin! Made from fresh, distilled Profiler juice. **//\n//* DEVELOPER new-xkit **//\n//* FRAME false **//\n//* BETA false **//\n\nXKit.extensions.mutualchecker = new Object({\n\t\n\trunning: false,\n\tusers: {},\n\t\n\tpreferences: {\n\t\t\"main_blog\": {\n\t\t\ttext: \"Blog to check for follow-backs on:\",\n\t\t\tdefault: \"\",\n\t\t\tvalue: \"\",\n\t\t\ttype: \"blog\"\n\t\t},\n\t\t\"put_in_front\": {\n\t\t\ttext: \"Place mutual icon before, not after usernames\",\n\t\t\tdefault: false,\n\t\t\tvalue: false\n\t\t}\n\t},\n\n\trun: function() {\n\t\tthis.running = true;\n\t\tif (this.preferences.main_blog.value === \"\") {\n\t\t\tthis.preferences.main_blog.value = XKit.tools.get_blogs()[0];\n\t\t}\n\t\tXKit.tools.init_css(\"mutualchecker\");\n\t\tXKit.extensions.mutualchecker.add_post_icons();\n\t\tXKit.extensions.mutualchecker.add_follower_icons();\n\t\tXKit.post_listener.add(\"mutualchecker\", XKit.extensions.mutualchecker.add_post_icons);\n\t},\n\n\tadd_follower_icons: function() {\n\t\t$(\".follower\").each(function() {\n\t\t\tvar url = $(this).find(\".name\").text();\n\t\t\tvar name_div = $(this).find(\".name\");\n\t\t\tXKit.interface.is_following(url, XKit.extensions.mutualchecker.preferences.main_blog.value).then(function(follow) {\n\t\t\t\tif (follow) {\n\t\t\t\t\tXKit.extensions.mutualchecker.add_label(name_div, url);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tadd_post_icons: function() {\n\t\t$(XKit.interface.get_posts(\"mutualchecker-done\")).each(function() {\n\t\t\t$(this).addClass(\"mutualchecker-done\");\n\t\t\tvar post = XKit.interface.post($(this));\n\t\t\tif (!XKit.interface.where().inbox && post.is_mine) { return; }\n\n\t\t\tif (!XKit.interface.where().dashboard) {\n\t\t\t\tvar json_info = $(this).find(\".post_avatar_link, .post-info-tumblelog a\").attr('data-tumblelog-popover');\n\t\t\t\ttry {\n\t\t\t\t\tvar json_obj = JSON.parse(json_info);\n\t\t\t\t\tif (!json_obj.following) { return; }\n\t\t\t\t\tpost.owner = json_obj.name;\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar name_div = {};\n\t\t\t$(this).find(\".post_header .post_info_link:not(.reblog_info)\").each(function() {\n\t\t\t\ttry {\n\t\t\t\t\tvar link_json = JSON.parse($(this).attr(\"data-peepr\"));\n\t\t\t\t\tif (link_json.tumblelog === post.owner) {\n\t\t\t\t\t\tname_div = $(this).first();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (name_div.length == undefined) {\n\t\t\t\tname_div = $(this).find(\".post_info_submissions, .post-info-tumblelog a\").first();\n\t\t\t}\n\t\t\tif (!name_div.length) { return; }\n\n\t\t\tif (typeof XKit.extensions.mutualchecker.users[post.owner] === \"undefined\") {\n\t\t\t\tXKit.interface.is_following(post.owner, XKit.extensions.mutualchecker.preferences.main_blog.value).then(function(follow) {\n\t\t\t\t\tif (follow) {\n\t\t\t\t\t\tXKit.extensions.mutualchecker.add_label(name_div, post.owner);\n\t\t\t\t\t\tXKit.extensions.mutualchecker.users[post.owner] = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tXKit.extensions.mutualchecker.users[post.owner] = false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (XKit.extensions.mutualchecker.users[post.owner]) {\n\t\t\t\tXKit.extensions.mutualchecker.add_label(name_div, post.owner);\n\t\t\t}\n\t\t});\n\t},\n\n\tadd_label: function(name_div, user) {\n\t\tif ($(name_div).hasClass(\"post_info_submissions\")) {\n\t\t\tname_div.html('<span class=\"mutuals' + ( XKit.extensions.mutualchecker.preferences.put_in_front.value ? \" mutuals-front\" : \"\") + '\">' + user + '</span>' + name_div.text().trim().substring(user.length));\n\t\t} else {\n\t\t\tname_div.addClass(\"mutuals\").attr(\"title\", user + \" follows you\");\n\t\t\tif (XKit.extensions.mutualchecker.preferences.put_in_front.value) { name_div.addClass(\"mutuals-front\"); }\n\t\t}\n\t},\n\n\tdestroy: function() {\n\t\tthis.running = false;\n\t\tthis.users = {};\n\t\tXKit.post_listener.remove(\"mutualchecker\");\n\t\t$(\".mutuals\").removeAttr(\"title\").removeClass(\"mutuals\").removeClass(\"mutuals-front\");\n\t\t$(\".mutualchecker-done\").removeClass(\"mutualchecker-done\");\n\t\tXKit.tools.remove_css(\"mutualchecker\");\n\t}\n});\n","file":"found","server":"up","errors":false,"icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAACGUlEQVRIS7XTzU8TQRgG8PeP62GzaW3TLxMFCR68SPDQBS4YoQYOiKCiFxMPbWH5iJAaAwmVCATx4gE8EBJNKX6gUMCP+HV1Z+fZnTrTylCyv9sz77zzpJuU/gSMfgcs+IJfAaOf9Ryvj7UbIS3nsvNYqo9+qI7ms7GQGUtpyeS2sFYffZdVn/bHQqGW0TXkM1ILXt695Pzya7kK8hnRN9m6W9AEM903u4NHBPoqe3GnFRun1zONRwT6IltzC3qmEPVsP7rqFqhbdCzjBd2TiJomu1lBnS06EvgljxFJXB4ovsXsJF4BolBbsHzvSjKZiPj/MDM9UNzD7CSNCw5lq6PuJ7IRfW9meuNutxHveLiKQ5/NC5StQ6rKVkZYQZeN6LO72BNc68gKTj18qm5V6UCGgglE38S/BTj18Km6dUD7suXbLezqOKJve/ZmW9j5Rka4re/xaxz6xnmBsrWvX/B/jQs+y56jAFGTV4Ao0Cdh+kbSEWffwWFGkxeu21uYbT4Zs9qjJhsY4fOdw3OvdjHhChYbWQVEgfYEfslnpjrvlypssFGwojj0Ra3ChrvFeQWIAn2ULQ2zT2TlER0Lg2m2LUsPLuCCI88LaraAPsie3WIFmTyiI59hyyr1Tu0J6BTomOmNNCh4LyvxghyipoZb9E5WGrroXG1KIlvEIwLtyhabLDBTHQ8W8UYNqgQs+IKdgFE5UOXyX4UwNMSHFXXQAAAAAElFTkSuQmCC","css":".mutuals::after, .mutuals::before{\n\tfont-family: tumblr-icons, None;\n\tfont-weight: normal;\n\tfont-size: 1.23em;\n\tline-height: 0;\n}\n\n.mutuals:not(.mutuals-front)::after{\n\tcontent: \"\\EA59\";\n\tpadding-left: 0.3em;\n}\n\n.mutuals.mutuals-front::before{\n\tcontent: \"\\EA59\";\n\tpadding-right: 0.3em;\n}\n","title":"Mutual Checker","description":"Adds an icon next to usernames to indicate if they follow you","developer":"new-xkit","version":"1.1.0","details":"Does what it says on the tin! Made from fresh, distilled Profiler juice.","frame":"false","beta":"false","slow":"false"}